!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("io"),require("axios")):"function"==typeof define&&define.amd?define(["io","axios"],t):"object"==typeof exports?exports.DeepJsonConnector=t(require("io"),require("axios")):e.DeepJsonConnector=t(e.io,e.axios)}(this,(function(e,t){return s={508:function(e,t,s){var n,r,o;o="undefined"!=typeof self?self:this,n=[s(742),s(676)],void 0===(r=function(e,t){return function(e,t,s){class n{constructor(t){this.baseURL=t.baseURL,this.token=t.token||null,this.storage=t.storage||"memory",this.binary=!1,this.overwriteKey=!1,this.getBody=!1,this.isNode="undefined"!=typeof process&&process.versions?.node,this.axios=e.create({baseURL:this.baseURL,timeout:t.timeout||1e4,headers:{Accept:"application/json","User-Agent":"DeepJSONConnector/1.0"}})}async login(e,t){try{const s=await this.axios.post("/auth/login",{username:e,password:t});return this.token=s.data.token,s.data}catch(e){this._handleError(e)}}getToken(){return this.token}isBinary(){return this.binary}setBinary(e){return this.binary=e,this}isOverwriteKey(){return this.overwriteKey}setOverwriteKey(e){return this.overwriteKey=e,this}hasGetBody(){return this.getBody}setGetBody(e){return this.getBody=e,this}async get(e,t=""){const s={},n={};let r="GET";return this.getBody&&(s["X-Method-Override"]="GET",r="POST"),this.binary&&(n.binary=!0,n.token=this.token),this._request(r,`/keys/${e}`,n,t,{headers:s})}async post(e,t){const s={};return this.overwriteKey&&(s["X-Override-Existing"]="true"),this._request("POST",`/keys/${e}`,null,t,{headers:s})}async put(e,t){return this._request("PUT",`/keys/${e}`,null,t,{headers:{}})}async delete(e){return this._request("DELETE",`/keys/${e}`,null,null,{headers:{}})}async move(e,t){var s={from:e,to:t};return this._request("POST","/cmd/move",null,JSON.stringify(s),{headers:{"Content-Type":"application/json; charset=utf-8"}})}async uploadFile(e,s,n={}){let r;this.isNode?(r=new t,r.append("file",s.stream(),{filename:s.name,knownLength:s.size})):(r=new t,r.append("file",s,s.name));const o={...this.isNode?r.getHeaders():{},"X-Override-Existing":n.overwrite?"true":"false"};return this._request("POST",`/keys/${e}`,null,r,{headers:o})}async listKeys(e){return this._request("GET","/admin/keys",e)}async _request(e,s,n=null,r=null,o={}){try{const i={method:e,url:s,headers:{...o.headers,...this.token&&{Authorization:`Bearer ${this.token}`}},params:n||{},data:r};return!this.isNode&&r instanceof t?(i.data=r,delete i.headers["Content-Type"]):i.headers["Content-Type"]||(i.headers["Content-Type"]="text/plain; charset=utf-8"),this._resetFlags(),(await this.axios(i)).data}catch(e){this._handleError(e)}}_resetFlags(){this.binary=!1,this.overwriteKey=!1,this.getBody=!1}_handleError(e){if(e.response){const t=new Error(`API Error: ${e.response.status} ${e.response.statusText}`);throw t.status=e.response.status,t.details=e.response.data,t}throw e.request?new Error("Network Error: No response from server"):new Error(`Request Error: ${e.message}`)}}class r extends n{constructor(e){super(e),this.socket=null,this.sessionHandlers=new Map,this.currentChannel=null}async createSession(){return this.socket&&this.disconnect(),this.socket=s(this.baseURL,{query:{token:this.token,action:"create"}}),new Promise(((e,t)=>{this.socket.on("session-created",(({channelId:t})=>{this.currentChannel=t,this._setupSocketListeners(),e(t)})),this.socket.on("error",t)}))}async joinSession(e){if(!e)throw new Error("Channel ID required");return this.socket&&this.disconnect(),this.socket=s(this.baseURL,{query:{token:this.token,action:"connect",channelId:e}}),new Promise(((t,s)=>{this.socket.on("session-joined",(s=>{this.currentChannel=e,this._setupSocketListeners(),t(s)})),this.socket.on("error",s)}))}on(e,t){this.sessionHandlers.has(e)||this.sessionHandlers.set(e,[]),this.sessionHandlers.get(e).push(t),this.socket&&this.socket.on(e,t)}off(e,t){if(this.sessionHandlers.has(e)){const s=this.sessionHandlers.get(e),n=s.indexOf(t);n>-1&&s.splice(n,1)}this.socket&&this.socket.off(e,t)}send(e,t){if(!this.socket||!this.socket.connected)throw new Error("Not connected to a session");this.socket.emit("message",{type:e,data:t})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.currentChannel=null)}reconnect(){if(this.currentChannel)return this.joinSession(this.currentChannel)}_setupSocketListeners(){this.socket&&(["connect","disconnect","reconnect","reconnecting"].forEach((e=>{this.socket.on(e,((...t)=>{this.sessionHandlers.get(e)?.forEach((e=>e(...t)))}))})),this.socket.on("message",(e=>{(this.sessionHandlers.get(e.type)||[]).forEach((t=>t(e.data)))})))}async login(e,t){const s=await super.login(e,t);return this.socket&&(this.socket.io.opts.query.token=this.token,this.reconnect()),s}}return{DeepJsonConnector:n,Sync:r,DeepJSONConnector:n,DeepJSONSyncConnector:r}}(e,o.FormData,t)}.apply(t,n))||(e.exports=r)},676:function(t){"use strict";t.exports=e},742:function(e){"use strict";e.exports=t}},n={},function e(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={exports:{}};return s[t].call(o.exports,o,o.exports,e),o.exports}(508);var s,n}));